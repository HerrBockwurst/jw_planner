<div id="useredit_editusercontent">
	<div style="font-weight: bold;">==useredit edit==</div>
	<form id="fEditUser" class="smallspacer">				
		<div style="width: 400px; float: left; margin-right: 20px;">
			<label>==common username== <input type="text" id="iEditUsername" disabled/></label>
			<label>==common name== <input type="text" id="iEditName" /></label>
			<label>==common password== <input type="password" id="iEditPassword" /></label>
			<label>==common email== <input type="text" id="iEditEmail" /></label>
		</div>
		<div style="width: 400px; float: left;">
			<label>==useredit role== 
				<select id="iEditRole">
				</select>
		
			</label>
			<label>==common versammlung==
				<select id="iEditVers">
				</select>	
			</label>
			<label>==useredit active== <input type="checkbox" id="iEditActive" style="float: right;"/></label>
		</div>
		<br class="floatbreak" />
		<div style="width: 400px; float: left; margin-right: 20px;">
			<fieldset>
				<legend>==useredit groups==</legend>
				<div id="dEditGroups">
				</div>						
			</fieldset>
		</div>
		<div style="width: 400px; float: left; margin-right: 20px;">
			<fieldset>
				<legend>==useredit specialPerms==</legend>
				<div id="dEditPerms">
				</div>
			</fieldset>
		</div>
		<br class="floatbreak" />
		<button>==useredit updateUser==</button>
		<button class="redbutton">==useredit DeleteUser==</button>
		<button class="redbutton">==common back==</button>
	</form>
</div>
<script>
	function UpdateUser() {
		var groups = {};
	
		$('#dEditGroups').children('label').each(function() {
			var input = $(this).children('input');
			groups[input.val()] = input.is(':checked') ? true : false;
		});
	
		var perms = {};
	
		$('#dEditPerms').children('label').each(function() {
			var input = $(this).children('input');
			perms[input.val()] = input.is(':checked') ? true : false;
		});
	
		var active = $('#iEditActive').is(':checked') ? 1 : 0;
	
		var data = {
			uid : $('#iEditUsername').val(),
			name : $('#iEditName').val(),
			password : $('#iEditPassword').val(),
			role : $('#iEditRole').val(),
			vers : $('#iEditVers').val(),
			email: $('#iEditEmail').val(),
			active : active,
			groups : groups,
			perms : perms
		}
		
		$.post('^PROTO^^HOME^/datahandler/useredit/updateUser', data, function(data) {
			displayLoadingBox();
			testError(data, true);
			UserEdit_SearchUser(hideLoadingBox);
			EditGoBack();
		});
	}
	
	function ConfirmedDelete() {
		displayLoadingBox();
		$.post('^PROTO^^HOME^/datahandler/useredit/deleteUser', {uid: $('#iEditUsername').val()}, function(data) {
			testRedirect(data);
			if(!testJSON(data)) {
				displayMessageBox('==errors formSubmit==', true);
				return;
			}
			if(testError(data, true, false)) return;
			
			UserEdit_SearchUser(hideLoadingBox);
			EditGoBack();
		});
	}
	
	function DeleteUser() {
		displayMessageBox('==useredit confirmDelete==', false,
		   {yes: '==common yes==',
			no: '==common no==',
			callback: ConfirmedDelete
			});
	}

	function EditGoBack() {
		$('#iEditPassword').val('');
		$('#Content').stop().animate({scrollTop: 0}, 200);
		$('#useredit_searchcontent').animate({left: "0%"}, 1000);
		$('#useredit_editusercontent').animate({left: "-100%"}, 1000);
	}

	$('#fEditUser').submit(function (e) {
		e.preventDefault();
	});

	$('#fEditUser').children('button').click(function() {
		if($(this).hasClass('redbutton') && $(this).is(':last-of-type')) EditGoBack();
		else if($(this).hasClass('redbutton')) DeleteUser();
		else UpdateUser();
	});
	
	$('#iEditVers').change(function() {
		displayLoadingBox();
		$.post('^PROTO^^HOME^/datahandler/useredit/getDataByVers', {vsid : $('#iEditVers').val()}, function(data) {
			testRedirect(data);
			if(!testJSON(data)) {
				displayMessageBox('==errors formSubmit==', true);
				return;
			}
			if(testError(data, true, true)) return;
			
			jdata = JSON.parse(data);
			
			$('#dEditGroups').html(jdata.fGroups);
			$('#iEditRole').html(jdata.fRoles);
			
			hideLoadingBox();		
		})
	});
</script>